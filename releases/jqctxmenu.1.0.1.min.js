/* jqCtxMenu - a jQuery plugin / 1.0-beta / Copyright 2014 All Rights Reserved.
 * License: MIT
 * Repository: https://github.com/hAWKdv/jqCtxMenu */
(function(e){"use strict";var t=2,n=2,r=-15,i="jqctx-container",s="jqctx",o="jqctx-sub",u="jqctx-arrow",a="name",f="action",l={},c=e("#"+i),h=c,p=0,d,v,m,g,y,b;y=function(){function e(){this._container=[]}e.prototype.isEmpty=function(){return!this._container.length};e.prototype.length=function(){return this._container.length};e.prototype.enqueue=function(e){this._container.push(e)};e.prototype.dequeue=function(){return this._container.shift()};return e}();l.isValid=function(e,t){if(!this.options[t][e]){throw new Error(e+" is mandatory for context menu object.")}};l.bindInitialEvent=function(){e(document).mousedown(function(){c.find("> ."+s).hide()})};l.buildInitialContainer=function(){var t;if(!e(i).length){t=e("<div>").attr("id",i);e("body").append(t);c=e("#"+i);h=c;this.bindInitialEvent()}};l.finalizeSetting=function(){g=e("."+o+" > ."+s);d=e("."+s).find("> li").css("padding-left").replace("px","");d=parseInt(d)};l.determineTotalWidth=function(){var t=new y,n=[],r,i,u;t.enqueue({widthSoFar:0,menu:m});while(!t.isEmpty()){u=t.dequeue();i=false;r=u.widthSoFar+u.menu.width();u.menu.find("> li > ."+o+" > ."+s).each(function(){i=true;t.enqueue({widthSoFar:r,menu:e(this)})});if(!i){n.push(r)}}p=Math.max.apply(null,n)};l.buildMenu=function(t){var n=e("<ul>").addClass(s);h.append(n);if(t){m=h.find(n)}else{v=h.find(n)}};l.buildOption=function(t,n){var r=e("<span>").text(n.name),i;if(n.icon){i=e("<img>").attr("src",n.icon);r.prepend(i)}if(n.group){t.css("border-bottom","none")}t.append(r)};l.addOption=function(t,n){var r=e("<li>"),i;l.buildOption(r,t);if(t.action){r.mousedown(t.action)}else if(t.location){r.mousedown(function(){window.location=t.location})}else if(t.menu){i=e("<div>").addClass(o);r.prepend(i);r.addClass(u);b.enqueue({container:r.find(i),options:t.menu})}if(n){m.append(r)}else{v.append(r)}};l.loadMenu=function(e){var t=0,n;for(t;t<this.options.length;t+=1){this.isValid(a,t);this.addOption(this.options[t],e)}if(e){m.data("width",m.width())}else{v.data("width",v.width())}if(!b.isEmpty()){n=b.dequeue();this.options=n.options;h=n.container;this.buildMenu();this.loadMenu()}};l.determineDirections=function(t){var n=e(window).innerWidth(),r=e(window).innerHeight(),i=m.outerHeight(),s={x:"",y:""};if(p+t.x<=n){s.x="right"}else{s.x="left"}if(i+t.y<=r){s.y="down"}else{s.y="up"}return s};l.positionMenu=function(t){var i={},o;o=l.determineDirections(t);if(o.x==="left"){i.left=t.x+n-d/2-m.width();g.each(function(){var t=e(this);t.css({marginLeft:-(t.data("width")+d)})})}else{i.left=t.x+n;g.each(function(){var t=e(this);t.css({marginLeft:t.parent().closest("."+s).data("width")-d})})}if(o.y==="up"){i.top=t.y-m.outerWidth()+r}else{i.top=t.y+r}m.css({top:i.top,left:i.left})};e.fn.jqCtxMenu=function(n){var r=e(this),i=false;b=new y;l.options=n;l.buildInitialContainer();l.buildMenu(true);l.loadMenu(true);l.finalizeSetting();l.determineTotalWidth();r.bind("contextmenu",function(){return false});r.mousedown(function(e){if(e.button===t){l.positionMenu({y:e.pageY,x:e.pageX});if(i){m.fadeIn()}else{m.css("visibility","visible");i=true}return false}return true});return this}})(jQuery);
